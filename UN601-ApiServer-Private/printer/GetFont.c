/*********************************************************************************
Copyright (C) 2006 ViewAt Technology Co., LTD.

System Name    :  vos
Module Name    :  read font dots driver
File   Name    :  getfont.c
Revision       :  01.00
Date           :  2006/12/1
Dir            :  drv\font
error code     :  -1600-1700
***********************************************************************************/
#include <string.h>
#include <stdlib.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <unistd.h>
#include <stdio.h>
#include "GB2312ToUnicode.h"
#include "GetFont.h"

#include "user.h"

static char g_gb2312_gbk_flag = 0; //标示当前汉字是gb2312字库还是gbk字库


unsigned char *FONTLIB_ADDR = NULL;


int fp_font;
int g_iChineseFontFlag;

typedef struct tagFlSectionInfo{ 
	WORD  First;  /* first character */ 
	WORD  Last;  /* last character */ 
	DWORD OffAddr; /*  指锟斤拷锟斤拷堑锟角癝ECTION锟斤拷锟� UFL_CHAR_INFO锟斤拷一锟斤拷锟街凤拷锟斤拷息锟斤拷锟斤拷始锟斤拷址 */
} FL_SECTION_INF, *PFL_SECTION_INF;

typedef struct tagFontLibHeader{ 
	BYTE magic[4]; /*'U'('S', 'M'), 'F', 'L', X---Unicode(Simple or MBCS), X: Version */
	DWORD dwFileSize;   /* File total size */ 
	BYTE nSection;  /* total sections */  
	BYTE YSize;    /* height of font  */    
	WORD wCpFlag;   /* codepageflag 每锟斤拷bit位锟斤拷示一锟斤拷锟街凤拷锟斤拷锟斤拷锟缴憋拷示16锟斤拷锟街凤拷*/
	WORD nTotalChars;  /* 锟杰碉拷锟斤拷效锟斤拷锟斤拷锟街凤拷锟斤拷 */
	char  reserved[2]; /*预锟斤拷锟街斤拷*/
	FL_SECTION_INF  *pSection;
} FL_Header, *PFL_Header;


typedef struct tagUflCharInfo{    
	DWORD  OffAddr : 26;  /* 锟斤拷前锟街凤拷锟斤拷锟斤拷锟捷碉拷锟斤拷始锟斤拷址 */
	DWORD  Width : 6;     /* 锟街凤拷锟斤拷锟斤拷锟斤拷锟截的匡拷锟�(目前锟斤拷锟街э拷值锟斤拷锟� < 64) */
} UFL_CHAR_INDEX;


extern int g_iUnicodePrinterFlag;
extern int g_iPrinterUnicode;

FL_Header _fl_header;
PFL_Header _pfl_header = (PFL_Header)NULL;

FL_SECTION_INF _fl_section_Inf;
PFL_SECTION_INF _pfl_section_Inf = (PFL_SECTION_INF)NULL;
int g_iUnicodeFontFlag;
int g_iUnicodeNoCJKFlag;
int g_iUnicodeBefore2f00Flag;
BYTE g_uWidth = 8;
BYTE g_uHeigh = 16;

char g_strLstErrMsg[256];
extern int Decompress(BYTE *srcbuf, BYTE *dstbuf, DWORD srclen, DWORD *dstlen);
VFONT_LIB_STRUCT g_sVFontLibHead;  // 锟街匡拷头锟结构锟斤拷锟斤拷锟斤拷
int g_iHaveFontFlag = 0;  // 锟街匡拷锟斤拷诒锟街撅拷锟�0锟斤拷示锟斤拷锟斤拷锟节ｏ拷1锟斤拷示锟斤拷锟斤拷
int g_iFontFileLen  = 0;  // 锟街匡拷锟侥硷拷锟斤拷锟斤拷
char *g_strFontLib;

#define DEFAULT_FONT  "/data/font/UnifouFont.bin"
#define DEFAULT_FONT2  "/system/font/PartnerFont.bin"
#define DEFAULT_FONT3  "/system/font/UnifouFont.bin"

const unsigned char Ch8ModAddr[]={
			0x00,0x00,0x00,0x00,0x00,0x00,    /*   */
			0x00,0x00,0x9e,0x00,0x00,0x00,    /* ! 0x21*/
			0x00,0x0e,0x00,0x0e,0x00,0x00,    /* " 0x22*/
			0x28,0xfe,0x28,0xfe,0x28,0x00,    /* # 0x23*/
			0x48,0x54,0xfe,0x54,0x24,0x00,    /* $ 0x24*/
			0x46,0x26,0x10,0xc8,0xc4,0x00,    /* % 0x25*/
			0x6c,0x92,0xaa,0x44,0xa0,0x00,    /* & 0x26*/
			0x00,0x0a,0x06,0x00,0x00,0x00,    /* ' 0x27*/
			0x00,0x38,0x44,0x82,0x00,0x00,    /* ( 0x28*/
			0x00,0x00,0x82,0x44,0x38,0x00,    /* ) 0x29*/
			0x28,0x10,0x7c,0x10,0x28,0x00,    /* * 0x2a*/
			0x10,0x10,0xfe,0x10,0x10,0x00,    /* + 0x2b*/
			0x00,0xa0,0x60,0x00,0x00,0x00,    /* , 0x2c*/
			0x10,0x10,0x10,0x10,0x10,0x00,    /* - 0x2d*/
			0x00,0xc0,0xc0,0x00,0x00,0x00,    /* . 0x2e*/
			0x40,0x20,0x10,0x08,0x04,0x00,    /* / 0x2f*/
			0x7c,0xa2,0x92,0x8a,0x7c,0x00,    /* 0 0x30*/
			0x00,0x84,0xfe,0x80,0x00,0x00,    /* 1 0x31*/
			0x84,0xc2,0xa2,0x92,0x8c,0x00,    /* 2 0x32*/
			0x42,0x82,0x8a,0x96,0x62,0x00,    /* 3 0x33*/
			0x30,0x28,0x24,0xfe,0x20,0x00,    /* 4 0x34*/
			0x4e,0x8a,0x8a,0x8a,0x72,0x00,    /* 5 0x35*/
			0x78,0x94,0x92,0x92,0x60,0x00,    /* 6 0x36*/
			0x02,0xe2,0x12,0x0a,0x06,0x00,    /* 7 0x37*/
			0x6c,0x92,0x92,0x92,0x6c,0x00,    /* 8 0x38*/
			0x0c,0x92,0x92,0x52,0x3c,0x00,    /* 9 0x39*/
			0x00,0x00,0xcc,0xcc,0x00,0x00,    /* : 0x3a*/
			0x00,0x00,0xa6,0x66,0x00,0x00,    /* ; 0x3b*/
			0x10,0x28,0x44,0x82,0x00,0x00,    /* < 0x3c*/
			0x48,0x48,0x48,0x48,0x48,0x00,    /* = 0x3d*/
			0x00,0x82,0x44,0x28,0x10,0x00,    /* > 0x3e*/
			0x04,0x02,0xa2,0x12,0x0c,0x00,    /* ? 0x3f*/
			0x64,0x92,0xf2,0x82,0x7c,0x00,    /* @ 0x40*/
			0xfc,0x22,0x22,0x22,0xfc,0x00,    /* A 0x41*/
			0xfe,0x92,0x92,0x92,0x6c,0x00,    /* B 0x42*/
			0x7c,0x82,0x82,0x82,0x44,0x00,    /* C 0x43*/
			0xfe,0x82,0x82,0x44,0x38,0x00,    /* D 0x44*/
			0xfe,0x92,0x92,0x92,0x82,0x00,    /* E 0x45*/
			0xfe,0x12,0x12,0x12,0x12,0x02,    /* F 0x46*/
			0x7c,0x82,0x82,0x92,0xf4,0x00,    /* G 0x47*/
			0xfe,0x10,0x10,0x10,0xfe,0x00,    /* H 0x48*/
			0x00,0x82,0xfe,0x82,0x00,0x00,    /* I 0x49*/
			0x40,0x80,0x82,0x7e,0x02,0x00,    /* J 0x4a*/
			0xfe,0x10,0x28,0x44,0x82,0x00,    /* K 0x4b*/
			0xfe,0x80,0x80,0x80,0x80,0x00,    /* L 0x4c*/
			0xfe,0x04,0x18,0x04,0xfe,0x00,    /* M 0x4d*/
			0xfe,0x08,0x10,0x20,0xfe,0x00,    /* N 0x4e*/
			0x7c,0x82,0x82,0x82,0x7c,0x00,    /* O 0x4f*/
			0xfe,0x12,0x12,0x12,0x0c,0x00,    /* P 0x50*/
			0x7c,0x82,0xa2,0x42,0xbc,0x00,    /* Q 0x51*/
			0xfe,0x12,0x32,0x52,0x8c,0x00,    /* R 0x52*/
			0x8c,0x92,0x92,0x92,0x62,0x00,    /* S 0x53*/
			0x02,0x02,0xfe,0x02,0x02,0x00,    /* T 0x54*/
			0x7e,0x80,0x80,0x80,0x7e,0x00,    /* U 0x55*/
			0x3e,0x40,0x80,0x40,0x3e,0x00,    /* V 0x56*/
			0x7e,0x80,0x70,0x80,0x7e,0x00,    /* W 0x57*/
			0xc6,0x28,0x10,0x28,0xc6,0x00,    /* X 0x58*/
			0x0e,0x10,0xe0,0x10,0x0e,0x00,    /* Y 0x59*/
			0xc2,0xa2,0x92,0x8a,0x86,0x00,    /* Z 0x5a*/
			0x00,0xfe,0x82,0x82,0x00,0x00,    /* [ 0x5b*/
			0x08,0x10,0x20,0x40,0x80,0x00,    /* \ 0x5c*/
			0x00,0x82,0x82,0xfe,0x00,0x00,    /* ] 0x5d*/
			0x08,0x04,0x02,0x04,0x08,0x00,    /* ^ 0x5e*/
			0x80,0x80,0x80,0x80,0x80,0x00,    /* _ 0x5f*/
			0x02,0x04,0x08,0x00,0x00,0x00,    /* ` 0x60*/
			0x40,0xa8,0xa8,0xa8,0xf0,0x00,    /* a 0x61*/
			0xfe,0x90,0x88,0x88,0x70,0x00,    /* b 0x62*/
			0x70,0x88,0x88,0x88,0x40,0x00,    /* c 0x63*/
			0x70,0x88,0x88,0x90,0xfe,0x00,    /* d 0x64*/
			0x70,0xa8,0xa8,0xa8,0x30,0x00,    /* e 0x65*/
			0x10,0xfc,0x12,0x12,0x04,0x00,    /* f 0x66*/
			0x18,0xa4,0xa4,0xa4,0x7c,0x00,    /* g 0x67*/
			0xfe,0x10,0x08,0x08,0xf0,0x00,    /* h 0x68*/
			0x00,0x88,0xfa,0x80,0x00,0x00,    /* i 0x69*/
			0x40,0x80,0x88,0x7a,0x00,0x00,    /* j 0x6a*/
			0xfe,0x20,0x50,0x88,0x00,0x00,    /* k 0x6b*/
			0x00,0x82,0xfe,0x80,0x00,0x00,    /* l 0x6c*/
			0xf8,0x08,0x30,0x08,0xf8,0x00,    /* m 0x6d*/
			0xf8,0x10,0x08,0x08,0xf0,0x00,    /* n 0x6e*/
			0x70,0x88,0x88,0x88,0x70,0x00,    /* o 0x6f*/
			0xf8,0x28,0x28,0x28,0x10,0x00,    /* p 0x70*/
			0x10,0x28,0x28,0x30,0xf8,0x00,    /* q 0x71*/
			0xf8,0x10,0x08,0x08,0x10,0x00,    /* r 0x72*/
			0x90,0xa8,0xa8,0xa8,0x40,0x00,    /* s 0x73*/
			0x08,0x7e,0x88,0x80,0x40,0x00,    /* t 0x74*/
			0x78,0x80,0x80,0x40,0xf8,0x00,    /* u 0x75*/
			0x38,0x40,0x80,0x40,0x38,0x00,    /* v 0x76*/
			0x78,0x80,0x60,0x80,0x78,0x00,    /* w 0x77*/
			0x88,0x50,0x20,0x50,0x88,0x00,    /* x 0x78*/
			0x98,0xa0,0xa0,0xa0,0x78,0x00,    /* y 0x79*/
			0x88,0xc8,0xa8,0x98,0x88,0x00,    /* z 0x7a*/
			0x00,0x10,0x6c,0x82,0x00,0x00,    /* { 0x7b*/
			0x00,0x00,0xfe,0x00,0x00,0x00,    /* | 0x7c*/
			0x00,0x82,0x6c,0x10,0x00,0x00,    /* } 0x7d*/
			0x08,0x04,0x08,0x08,0x04,0x00,    /* ~ 0x7e*/
			0xfe,0xfe,0xfe,0xfe,0xfe,0x00     /*  */
};

const unsigned char Ch16ModAddr[]={
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    /*   */
0x00,0x00,0x70,0xf8,0xf8,0x70,0x00,0x00,0x00,0x00,0x00,0x1b,0x1b,0x00,0x00,0x00,    /* ! */
0x00,0x1c,0x3c,0x00,0x00,0x3c,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    /* " */
0x40,0xf0,0xf0,0x40,0xf0,0xf0,0x40,0x00,0x04,0x1f,0x1f,0x04,0x1f,0x1f,0x04,0x00,    /* # */
0x70,0xf8,0x88,0x8e,0x8e,0x98,0x30,0x00,0x0c,0x18,0x10,0x70,0x70,0x1f,0x0f,0x00,    /* $ */
0x60,0x60,0x00,0x00,0x80,0xc0,0x60,0x00,0x18,0x0c,0x06,0x03,0x01,0x18,0x18,0x00,    /* % */
0x00,0xb0,0xf8,0xc8,0x78,0xb0,0x80,0x00,0x0f,0x1f,0x10,0x11,0x0f,0x1f,0x10,0x00,    /* & */
0x00,0x20,0x3c,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    /* ' */
0x00,0x00,0xe0,0xf0,0x18,0x08,0x00,0x00,0x00,0x00,0x07,0x0f,0x18,0x10,0x00,0x00,    /* ( */
0x00,0x00,0x08,0x18,0xf0,0xe0,0x00,0x00,0x00,0x00,0x10,0x18,0x0f,0x07,0x00,0x00,    /* ) */
0x00,0x40,0xc0,0x80,0x80,0xc0,0x40,0x00,0x01,0x05,0x07,0x03,0x03,0x07,0x05,0x01,    /* * */
0x00,0x00,0x00,0xc0,0xc0,0x00,0x00,0x00,0x00,0x01,0x01,0x07,0x07,0x01,0x01,0x00,    /* + */
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x3c,0x1c,0x00,0x00,0x00,    /* , */
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,    /* - */
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,    /* . */
0x00,0x00,0x00,0x00,0x80,0xc0,0x60,0x00,0x18,0x0c,0x06,0x03,0x01,0x00,0x00,0x00,    /* / */
0xe0,0xf0,0x18,0x88,0x18,0xf0,0xe0,0x00,0x07,0x0f,0x18,0x11,0x18,0x0f,0x07,0x00,    /* 0 */
0x00,0x20,0x30,0xf8,0xf8,0x00,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,0x10,0x00,    /* 1 */
0x10,0x18,0x08,0x88,0xc8,0x78,0x30,0x00,0x1c,0x1e,0x13,0x11,0x10,0x18,0x18,0x00,    /* 2 */
0x10,0x18,0x88,0x88,0x88,0xf8,0x70,0x00,0x08,0x18,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* 3 */
0x80,0xc0,0x60,0x30,0xf8,0xf8,0x00,0x00,0x01,0x01,0x01,0x11,0x1f,0x1f,0x11,0x00,    /* 4 */
0xf8,0xf8,0x88,0x88,0x88,0x88,0x08,0x00,0x08,0x18,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* 5 */
0xe0,0xf0,0x98,0x88,0x88,0x80,0x00,0x00,0x0f,0x1f,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* 6 */
0x18,0x18,0x08,0x08,0x88,0xf8,0x78,0x00,0x00,0x00,0x1e,0x1f,0x01,0x00,0x00,0x00,    /* 7 */
0x70,0xf8,0x88,0x88,0x88,0xf8,0x70,0x00,0x0f,0x1f,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* 8 */
0x70,0xf8,0x88,0x88,0x88,0xf8,0xf0,0x00,0x00,0x10,0x10,0x10,0x18,0x0f,0x07,0x00,    /* 9 */
0x00,0x00,0x00,0x60,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x0c,0x00,0x00,0x00,    /* : */
0x00,0x00,0x00,0x60,0x60,0x00,0x00,0x00,0x00,0x00,0x10,0x1c,0x0c,0x00,0x00,0x00,    /* ; */
0x00,0x00,0x80,0xc0,0x60,0x30,0x10,0x00,0x00,0x01,0x03,0x06,0x0c,0x18,0x10,0x00,    /* < */
0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x00,0x00,0x02,0x02,0x02,0x02,0x02,0x02,0x00,    /* = */
0x00,0x10,0x30,0x60,0xc0,0x80,0x00,0x00,0x00,0x10,0x18,0x0c,0x06,0x03,0x01,0x00,    /* > */
0x30,0x38,0x08,0x88,0xc8,0x78,0x30,0x00,0x00,0x00,0x00,0x1b,0x1b,0x00,0x00,0x00,    /* ? */
0xe0,0xf0,0x10,0x90,0x90,0xf0,0xe0,0x00,0x0f,0x1f,0x10,0x17,0x17,0x17,0x03,0x00,    /* @ */
0xc0,0xe0,0x30,0x18,0x30,0xe0,0xc0,0x00,0x1f,0x1f,0x01,0x01,0x01,0x1f,0x1f,0x00,    /* A */
0x08,0xf8,0xf8,0x88,0x88,0xf8,0x70,0x00,0x10,0x1f,0x1f,0x10,0x10,0x1f,0x0f,0x00,    /* B */
0xe0,0xf0,0x18,0x08,0x08,0x18,0x30,0x00,0x07,0x0f,0x18,0x10,0x10,0x18,0x0c,0x00,    /* C */
0x08,0xf8,0xf8,0x08,0x18,0xf0,0xe0,0x00,0x10,0x1f,0x1f,0x10,0x18,0x0f,0x07,0x00,    /* D */
0x08,0xf8,0xf8,0x88,0xc8,0x18,0x38,0x00,0x10,0x1f,0x1f,0x10,0x11,0x18,0x1c,0x00,    /* E */
0x08,0xf8,0xf8,0x88,0xc8,0x18,0x38,0x00,0x10,0x1f,0x1f,0x10,0x01,0x00,0x00,0x00,    /* F */
0xe0,0xf0,0x18,0x08,0x08,0x18,0x30,0x00,0x07,0x0f,0x18,0x11,0x11,0x0f,0x1f,0x00,    /* G */
0xf8,0xf8,0x80,0x80,0x80,0xf8,0xf8,0x00,0x1f,0x1f,0x00,0x00,0x00,0x1f,0x1f,0x00,    /* H */
0x00,0x00,0x08,0xf8,0xf8,0x08,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,    /* I */
0x00,0x00,0x00,0x08,0xf8,0xf8,0x08,0x00,0x0e,0x1e,0x10,0x10,0x1f,0x0f,0x00,0x00,    /* J */
0x08,0xf8,0xf8,0x80,0xc0,0x78,0x38,0x00,0x10,0x1f,0x1f,0x01,0x03,0x1e,0x1c,0x00,    /* K */
0x08,0xf8,0xf8,0x08,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x10,0x18,0x1c,0x00,    /* L */
0xf8,0xf8,0x70,0xe0,0x70,0xf8,0xf8,0x00,0x1f,0x1f,0x00,0x00,0x00,0x1f,0x1f,0x00,    /* M */
0xf8,0xf8,0x70,0xe0,0xc0,0xf8,0xf8,0x00,0x1f,0x1f,0x00,0x00,0x01,0x1f,0x1f,0x00,    /* N */
0xf0,0xf8,0x08,0x08,0x08,0xf8,0xf0,0x00,0x0f,0x1f,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* O */
0x08,0xf8,0xf8,0x88,0x88,0xf8,0x70,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,0x00,0x00,    /* P */
0xf0,0xf8,0x08,0x08,0x08,0xf8,0xf0,0x00,0x0f,0x1f,0x10,0x1c,0x78,0x7f,0x4f,0x00,    /* Q */
0x08,0xf8,0xf8,0x88,0x88,0xf8,0x70,0x00,0x10,0x1f,0x1f,0x00,0x01,0x1f,0x1e,0x00,    /* R */
0x30,0x78,0xc8,0x88,0x88,0x38,0x30,0x00,0x0c,0x1c,0x10,0x10,0x11,0x1f,0x0e,0x00,    /* S */
0x00,0x38,0x18,0xf8,0xf8,0x18,0x38,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,    /* T */
0xf8,0xf8,0x00,0x00,0x00,0xf8,0xf8,0x00,0x0f,0x1f,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* U */
0xf8,0xf8,0x00,0x00,0x00,0xf8,0xf8,0x00,0x03,0x07,0x0c,0x18,0x0c,0x07,0x03,0x00,    /* V */
0xf8,0xf8,0x00,0x80,0x00,0xf8,0xf8,0x00,0x0f,0x1f,0x1c,0x07,0x1c,0x1f,0x0f,0x00,    /* W */
0x18,0x78,0xe0,0xc0,0xe0,0x78,0x18,0x00,0x18,0x1e,0x07,0x03,0x07,0x1e,0x18,0x00,    /* X */
0x00,0x78,0xf8,0x80,0x80,0xf8,0x78,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,    /* Y */
0x38,0x18,0x08,0x88,0xc8,0x78,0x38,0x00,0x1c,0x1e,0x13,0x11,0x10,0x18,0x1c,0x00,    /* Z */
0x00,0x00,0xf8,0xf8,0x08,0x08,0x00,0x00,0x00,0x00,0x1f,0x1f,0x10,0x10,0x00,0x00,    /* [ */
0x70,0xe0,0xc0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0e,0x1c,0x00,    /* \ */
0x00,0x00,0x08,0x08,0xf8,0xf8,0x00,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x00,0x00,    /* ] */
0x10,0x18,0x0c,0x06,0x0c,0x18,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    /* ^ */
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,    /* _ */
0x00,0x00,0x06,0x0e,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    /* ` */
0x00,0x40,0x40,0x40,0xc0,0x80,0x00,0x00,0x0e,0x1f,0x11,0x11,0x0f,0x1f,0x10,0x00,    /* a */
0x08,0xf8,0xf8,0x40,0xc0,0x80,0x00,0x00,0x00,0x1f,0x1f,0x10,0x10,0x1f,0x0f,0x00,    /* b */
0x80,0xc0,0x40,0x40,0x40,0xc0,0x80,0x00,0x0f,0x1f,0x10,0x10,0x10,0x18,0x08,0x00,    /* c */
0x00,0x80,0xc0,0x48,0xf8,0xf8,0x00,0x00,0x0f,0x1f,0x10,0x10,0x0f,0x1f,0x10,0x00,    /* d */
0x80,0xc0,0x40,0x40,0x40,0xc0,0x80,0x00,0x0f,0x1f,0x11,0x11,0x11,0x19,0x09,0x00,    /* e */
0x80,0xf0,0xf8,0x88,0x18,0x30,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,0x00,0x00,    /* f */
0x80,0xc0,0x40,0x40,0x80,0xc0,0x40,0x00,0x4f,0xdf,0x90,0x90,0xff,0x7f,0x00,0x00,    /* g */
0x08,0xf8,0xf8,0x80,0x40,0xc0,0x80,0x00,0x10,0x1f,0x1f,0x00,0x00,0x1f,0x1f,0x00,    /* h */
0x00,0x00,0x40,0xd8,0xd8,0x00,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,    /* i */
0x00,0x00,0x00,0x00,0x40,0xd8,0xd8,0x00,0x00,0x60,0xe0,0x80,0x80,0xff,0x7f,0x00,    /* j */
0x08,0xf8,0xf8,0x00,0x80,0xc0,0x40,0x00,0x10,0x1f,0x1f,0x03,0x07,0x1c,0x18,0x00,    /* k */
0x00,0x00,0x08,0xf8,0xf8,0x00,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,    /* l */
0xc0,0xc0,0xc0,0x80,0xc0,0xc0,0x80,0x00,0x1f,0x1f,0x00,0x0f,0x00,0x1f,0x1f,0x00,    /* m */
0x40,0xc0,0x80,0x40,0x40,0xc0,0x80,0x00,0x00,0x1f,0x1f,0x00,0x00,0x1f,0x1f,0x00,    /* n */
0x80,0xc0,0x40,0x40,0x40,0xc0,0x80,0x00,0x0f,0x1f,0x10,0x10,0x10,0x1f,0x0f,0x00,    /* o */
0x40,0xc0,0x80,0x40,0x40,0xc0,0x80,0x00,0x80,0xff,0xff,0x90,0x10,0x1f,0x0f,0x00,    /* p */
0x80,0xc0,0x40,0x40,0x80,0xc0,0x40,0x00,0x0f,0x1f,0x10,0x90,0xff,0xff,0x80,0x00,    /* q */
0x40,0xc0,0x80,0xc0,0x40,0xc0,0x80,0x00,0x10,0x1f,0x1f,0x10,0x00,0x01,0x01,0x00,    /* r */
0x80,0xc0,0x40,0x40,0x40,0xc0,0x80,0x00,0x08,0x19,0x13,0x12,0x16,0x1c,0x08,0x00,    /* s */
0x40,0x40,0xf0,0xf8,0x40,0x40,0x00,0x00,0x00,0x00,0x0f,0x1f,0x10,0x18,0x08,0x00,    /* t */
0xc0,0xc0,0x00,0x00,0xc0,0xc0,0x00,0x00,0x0f,0x1f,0x10,0x10,0x0f,0x1f,0x10,0x00,    /* u */
0x00,0xc0,0xc0,0x00,0x00,0xc0,0xc0,0x00,0x00,0x07,0x0f,0x18,0x18,0x0f,0x07,0x00,    /* v */
0xc0,0xc0,0x00,0x00,0x00,0xc0,0xc0,0x00,0x0f,0x1f,0x18,0x0f,0x18,0x1f,0x0f,0x00,    /* w */
0x40,0xc0,0x80,0x00,0x80,0xc0,0x40,0x00,0x10,0x18,0x0f,0x07,0x0f,0x18,0x10,0x00,    /* x */
0xc0,0xc0,0x00,0x00,0x00,0xc0,0xc0,0x00,0x8f,0x9f,0x90,0x90,0xd0,0x7f,0x3f,0x00,    /* y */
0xc0,0xc0,0x40,0x40,0xc0,0xc0,0x40,0x00,0x18,0x1c,0x16,0x13,0x11,0x18,0x18,0x00,    /* z */
0x00,0x80,0x80,0xf0,0x78,0x08,0x08,0x00,0x00,0x00,0x00,0x0f,0x1f,0x10,0x10,0x00,    /* { */
0x00,0x00,0x00,0x78,0x78,0x00,0x00,0x00,0x00,0x00,0x00,0x1f,0x1f,0x00,0x00,0x00,    /* | */
0x00,0x08,0x08,0x78,0xf0,0x80,0x80,0x00,0x00,0x10,0x10,0x1f,0x0f,0x00,0x00,0x00,    /* } */
0x10,0x18,0x08,0x18,0x10,0x18,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,    /* ~ */
0x00,0x80,0xc0,0x60,0xc0,0x80,0x00,0x00,0x0f,0x0f,0x08,0x08,0x08,0x0f,0x0f,0x00     /*  */
};

const BYTE Fnt_asc12x24[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xf0,0xf0,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7f,0x7f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x1c,0x1c,0x00,0x00,0x00,0x00,
0x00,0x00,0xc0,0x70,0x3c,0x9c,0xcc,0x70,0x3c,0x1c,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0xc0,0xe0,0x00,0x00,0x00,0x00,0xe0,0x00,0x00,0x00,0x86,0x86,0xff,0x9f,0x86,0x86,0x86,0xfe,0xff,0x86,0x86,0x00,0x01,0x1d,0x1f,0x01,0x01,0x01,0x01,0x1f,0x01,0x01,0x01,
0x00,0x00,0x80,0xc0,0x60,0x20,0xf8,0x20,0xe0,0xc0,0x80,0x00,0x00,0x00,0x07,0x0f,0x1e,0x18,0xff,0x70,0xe1,0xc1,0x80,0x00,0x00,0x02,0x0f,0x1f,0x12,0x10,0x7f,0x10,0x1d,0x0f,0x07,0x00,
0x80,0xc0,0x60,0x20,0xe0,0xc0,0x00,0x00,0xc0,0x60,0x00,0x00,0x0f,0x3f,0x30,0x20,0xbf,0xff,0xbc,0xef,0x31,0x10,0xf0,0xe0,0x00,0x00,0x10,0x1e,0x07,0x00,0x03,0x0f,0x18,0x10,0x1f,0x0f,
0x00,0x00,0xc0,0xe0,0x20,0x20,0xe0,0xc0,0x00,0x00,0x00,0x00,0x80,0xe0,0xff,0x3f,0xf8,0xec,0x87,0x07,0xfc,0x7c,0x04,0x00,0x03,0x0f,0x1f,0x18,0x10,0x13,0x1f,0x0f,0x1f,0x18,0x10,0x0c,
0x00,0x80,0xcc,0x7c,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xe0,0x70,0x18,0x0c,0x04,0x00,0x00,0x00,0x00,0x00,0xfe,0xff,0xc7,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x0f,0x1c,0x30,0x60,0x40,
0x00,0x04,0x0c,0x38,0xf0,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x38,0x00,0x00,0x00,0x00,0x00,0x40,0x60,0x38,0x1e,0x07,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xc0,0xc0,0xc0,0x00,0x00,0x00,0x00,0x00,0x42,0x66,0x66,0x3c,0xdb,0xff,0x9d,0x24,0x66,0x66,0x42,0x00,0x00,0x00,0x00,0x00,0x03,0x03,0x03,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x10,0xff,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xcc,0x7c,0x3c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x1c,0x1c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xf0,0x1c,0x04,0x00,0x00,0x00,0x00,0x80,0xf0,0x3c,0x0f,0x03,0x00,0x00,0x00,0x00,0x60,0x78,0x0e,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0xc0,0xe0,0x20,0x20,0x60,0xe0,0xc0,0x00,0x00,0x00,0xfe,0xff,0xff,0x00,0x00,0x00,0x00,0x01,0xff,0xff,0x38,0x00,0x01,0x07,0x0f,0x1c,0x10,0x10,0x18,0x1e,0x0f,0x03,0x00,
0x00,0x00,0x00,0x80,0x80,0xc0,0xe0,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x1f,0x10,0x10,0x00,0x00,
0x00,0x00,0xc0,0xc0,0x60,0x20,0x20,0x60,0xe0,0xc0,0x80,0x00,0x00,0x01,0x03,0x03,0x00,0x80,0xc0,0x70,0x3c,0x1f,0x07,0x00,0x00,0x18,0x1c,0x1a,0x19,0x18,0x18,0x18,0x18,0x1c,0x1f,0x00,
0x00,0x00,0xc0,0xc0,0x20,0x20,0x20,0x60,0xe0,0xc0,0x00,0x00,0x00,0x00,0x03,0x03,0x00,0x10,0x10,0x38,0x6f,0xe7,0xc3,0x00,0x00,0x02,0x0f,0x1f,0x18,0x10,0x10,0x18,0x1c,0x0f,0x07,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xe0,0xf0,0x00,0x00,0x00,0x00,0xc0,0xe0,0xb8,0x8e,0x83,0x81,0xff,0xff,0x80,0x80,0x80,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x18,0x10,0x10,
0x00,0x00,0xc0,0xe0,0x60,0x60,0x60,0x60,0x60,0x60,0x60,0x00,0x00,0x00,0x3f,0x3f,0x18,0x08,0x08,0x08,0x38,0xf0,0xe0,0x00,0x00,0x02,0x0f,0x0f,0x10,0x10,0x10,0x18,0x1c,0x0f,0x07,0x00,
0x00,0x00,0x80,0xc0,0xc0,0x60,0x20,0x20,0xe0,0xe0,0x00,0x00,0x00,0xfc,0xff,0xff,0x18,0x08,0x08,0x08,0x18,0xf0,0xe0,0x00,0x00,0x01,0x07,0x0f,0x18,0x10,0x10,0x10,0x1c,0x0f,0x07,0x00,
0x00,0x00,0xe0,0xe0,0x60,0x60,0x60,0x60,0x60,0xe0,0x60,0x00,0x00,0x02,0x03,0x00,0x00,0xc0,0xf0,0x3c,0x07,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x1e,0x1f,0x1f,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xc0,0xe0,0x60,0x20,0x20,0x20,0x60,0xc0,0x80,0x00,0x00,0x83,0xc7,0x6f,0x3c,0x18,0x30,0x30,0x78,0xef,0xc7,0x00,0x00,0x07,0x0f,0x1c,0x18,0x10,0x10,0x10,0x18,0x0f,0x07,0x00,
0x00,0x00,0xc0,0xe0,0x60,0x20,0x20,0x20,0xe0,0xc0,0x80,0x00,0x00,0x1f,0x3f,0x7f,0x60,0x40,0x40,0x60,0x30,0xff,0xff,0x00,0x00,0x00,0x0c,0x1c,0x1c,0x10,0x10,0x18,0x0f,0x07,0x01,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x0e,0x0e,0x0e,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x1c,0x1c,0x1c,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0c,0x0c,0x0c,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x78,0x78,0x18,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xc0,0x60,0x30,0x10,0x00,0x00,0x10,0x38,0x6c,0xc6,0x83,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x03,0x06,0x0c,0x18,0x10,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x84,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x30,0x60,0xc0,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x83,0xc6,0x6c,0x38,0x10,0x00,0x00,0x00,0x18,0x0c,0x06,0x03,0x01,0x00,0x00,0x00,0x00,0x00,
0x00,0x80,0xe0,0x20,0x30,0x10,0x10,0x10,0x30,0xe0,0xe0,0x80,0x00,0x03,0x03,0x03,0x00,0xe0,0xf0,0x18,0x0c,0x0f,0x07,0x01,0x00,0x00,0x00,0x00,0x08,0x1c,0x1c,0x1c,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0xc0,0x60,0x60,0x20,0x20,0x60,0x40,0xc0,0x00,0x00,0xfe,0xff,0x41,0xfc,0x9e,0x83,0xf1,0xff,0x0f,0xe3,0x7f,0x00,0x01,0x07,0x0e,0x19,0x11,0x11,0x11,0x19,0x09,0x0e,0x02,
0x00,0x00,0x00,0x00,0x80,0xe0,0xe0,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xf8,0x5f,0x41,0x47,0x7f,0xfc,0xc0,0x00,0x00,0x10,0x18,0x1f,0x11,0x00,0x00,0x00,0x10,0x17,0x1f,0x1e,0x10,
0x20,0x20,0xe0,0xe0,0x20,0x20,0x20,0x20,0xe0,0xc0,0xc0,0x00,0x00,0x00,0xff,0xff,0x10,0x10,0x10,0x18,0x3c,0xef,0xe7,0x80,0x10,0x10,0x1f,0x1f,0x10,0x10,0x10,0x10,0x18,0x1f,0x0f,0x07,
0x00,0x00,0x80,0xc0,0xe0,0x60,0x20,0x20,0x20,0x60,0xe0,0x80,0x00,0xfe,0xff,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x00,0x03,0x07,0x0f,0x18,0x10,0x10,0x10,0x18,0x0c,0x07,0x03,
0x00,0x20,0xe0,0xe0,0x20,0x20,0x20,0x60,0xc0,0xc0,0x80,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xfe,0x00,0x10,0x1f,0x1f,0x10,0x10,0x10,0x18,0x0c,0x0f,0x07,0x00,
0x00,0x20,0xe0,0xe0,0x20,0x20,0x20,0x20,0x20,0x60,0xe0,0x80,0x00,0x00,0xff,0xff,0x10,0x10,0x10,0x10,0x7c,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x10,0x10,0x10,0x10,0x18,0x1e,0x06,
0x20,0x20,0xe0,0xe0,0x20,0x20,0x20,0x20,0x20,0x60,0xe0,0xc0,0x00,0x00,0xff,0xff,0x10,0x10,0x10,0x10,0x7c,0x7c,0x00,0x01,0x10,0x10,0x1f,0x1f,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0xc0,0xe0,0x20,0x20,0x20,0x60,0xe0,0x80,0x00,0x00,0xfe,0xff,0x03,0x00,0x00,0x00,0x40,0xc0,0xc1,0xc1,0x40,0x00,0x03,0x07,0x0f,0x18,0x10,0x10,0x10,0x1f,0x0f,0x0f,0x00,
0x20,0x20,0xe0,0xe0,0x20,0x00,0x00,0x20,0x20,0xe0,0xe0,0x20,0x00,0x00,0xff,0xff,0x10,0x10,0x10,0x10,0x10,0xff,0xff,0x00,0x10,0x10,0x1f,0x1f,0x10,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,
0x00,0x00,0x20,0x20,0x20,0xe0,0xe0,0xe0,0x20,0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x1f,0x1f,0x1f,0x10,0x10,0x10,0x00,
0x00,0x00,0x00,0x00,0x20,0x20,0x20,0xe0,0xe0,0x20,0x20,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x00,0x60,0xe0,0xa0,0x80,0x80,0xe0,0x7f,0x3f,0x00,0x00,0x00,
0x00,0x20,0xe0,0xe0,0x20,0x20,0x00,0x20,0xe0,0x60,0x20,0x20,0x00,0x00,0xff,0xff,0x30,0x3c,0xfe,0xe3,0x81,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x10,0x10,0x00,0x11,0x1f,0x1e,0x18,0x10,
0x00,0x20,0xe0,0xe0,0xe0,0x20,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x1f,0x1f,0x1f,0x10,0x10,0x10,0x10,0x18,0x1c,0x06,
0x20,0xe0,0xe0,0xe0,0x00,0x00,0x00,0x00,0xc0,0xe0,0xe0,0x20,0x00,0xff,0xff,0x3f,0xfe,0xe0,0xc0,0xfc,0x0f,0xff,0xff,0x00,0x10,0x1f,0x1f,0x10,0x07,0x1f,0x1f,0x01,0x10,0x1f,0x1f,0x10,
0x20,0x20,0xe0,0xe0,0xc0,0x00,0x00,0x00,0x20,0x20,0xe0,0x20,0x00,0x00,0xff,0x01,0x07,0x1f,0x7c,0xf0,0xc0,0x00,0xff,0x00,0x10,0x10,0x1f,0x10,0x10,0x00,0x00,0x01,0x07,0x1f,0x1f,0x00,
0x00,0x00,0x80,0xc0,0x60,0x20,0x20,0x20,0x60,0xc0,0x80,0x00,0x00,0xfe,0xff,0x03,0x00,0x00,0x00,0x00,0x00,0x87,0xff,0xfe,0x00,0x01,0x07,0x0f,0x18,0x10,0x10,0x10,0x18,0x0f,0x07,0x01,
0x20,0x20,0xe0,0xe0,0x20,0x20,0x20,0x20,0x60,0xc0,0xc0,0x00,0x00,0x00,0xff,0xff,0x20,0x20,0x20,0x20,0x30,0x1f,0x1f,0x07,0x10,0x10,0x1f,0x1f,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x80,0xc0,0x60,0x20,0x20,0x20,0x60,0xc0,0x80,0x00,0x00,0xff,0xff,0x03,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0xfe,0x00,0x03,0x07,0x0e,0x1f,0x11,0x17,0x3f,0x7c,0x7f,0x67,0x21,
0x00,0x20,0xe0,0xe0,0x20,0x20,0x20,0x20,0x60,0xe0,0xc0,0x00,0x00,0x00,0xff,0xff,0x10,0x10,0x70,0xf0,0xd8,0x0f,0x07,0x00,0x00,0x10,0x1f,0x1f,0x10,0x10,0x00,0x01,0x0f,0x1f,0x18,0x10,
0x00,0x80,0xc0,0xe0,0x20,0x20,0x20,0x20,0x60,0xc0,0xe0,0x00,0x00,0x07,0x0f,0x0c,0x18,0x18,0x30,0x30,0x60,0xe0,0xc1,0x00,0x00,0x07,0x1f,0x0c,0x18,0x10,0x10,0x10,0x18,0x0f,0x07,0x00,
0x00,0xe0,0xe0,0x20,0x20,0xe0,0xe0,0x20,0x20,0x60,0xe0,0x80,0x00,0x01,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x01,0x01,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,0x10,0x00,0x00,0x00,
0x20,0x20,0xe0,0xe0,0x20,0x00,0x00,0x00,0x20,0xe0,0xe0,0x20,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x0f,0x0f,0x18,0x10,0x10,0x10,0x18,0x0f,0x07,0x00,
0x20,0x20,0xe0,0xe0,0x20,0x00,0x00,0x00,0x20,0xe0,0x60,0x20,0x00,0x00,0x03,0x3f,0xfe,0xf0,0x00,0xf0,0x7e,0x07,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x1f,0x1f,0x03,0x00,0x00,0x00,0x00,
0x20,0xe0,0xe0,0x20,0x20,0xe0,0xe0,0xe0,0x00,0x20,0xe0,0x60,0x00,0x03,0xff,0xfe,0xc0,0xfe,0x3f,0xff,0xe0,0xfe,0x0f,0x00,0x00,0x00,0x00,0x1f,0x1f,0x01,0x00,0x1f,0x1f,0x03,0x00,0x00,
0x00,0x20,0x60,0xe0,0xe0,0x20,0x00,0x20,0xa0,0xe0,0x20,0x20,0x00,0x00,0x00,0x01,0x87,0xfe,0xf8,0xee,0x83,0x00,0x00,0x00,0x00,0x10,0x18,0x1e,0x13,0x00,0x00,0x13,0x1f,0x1e,0x18,0x10,
0x20,0x20,0xe0,0xe0,0x20,0x00,0x00,0x00,0x20,0xe0,0x60,0x20,0x00,0x00,0x01,0x07,0x1f,0xfc,0xe0,0x3c,0x0f,0x01,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,0x10,0x00,0x00,0x00,
0x00,0x80,0xe0,0x60,0x20,0x20,0x20,0x20,0xe0,0xe0,0x60,0x20,0x00,0x00,0x00,0x00,0xc0,0xf0,0x7c,0x1f,0x07,0x01,0x00,0x00,0x00,0x10,0x1c,0x1f,0x17,0x11,0x10,0x10,0x10,0x18,0x1e,0x02,
0x00,0x00,0x00,0x00,0x00,0xfc,0x04,0x04,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7f,0x40,0x40,0x40,0x40,0x40,0x00,
0x00,0x00,0x30,0xf0,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x1f,0xf8,0xe0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x1f,0x7c,0xe0,0x80,
0x00,0x00,0x04,0x04,0x04,0x04,0xfc,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x40,0x40,0x40,0x7f,0x7f,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x10,0x1c,0x0c,0x04,0x0c,0x18,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,0x80,
0x00,0x00,0x04,0x04,0x04,0x0c,0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x98,0xdc,0x44,0x64,0x24,0x24,0xfc,0xf8,0x00,0x00,0x00,0x0f,0x1f,0x1f,0x10,0x10,0x10,0x18,0x0f,0x1f,0x10,0x18,
0x00,0x20,0xe0,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x18,0x0c,0x04,0x04,0x0c,0xfc,0xf8,0x80,0x00,0x00,0x1f,0x0f,0x18,0x10,0x10,0x10,0x18,0x0f,0x07,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xf0,0xf8,0x1c,0x04,0x04,0x04,0x3c,0x38,0x30,0x00,0x00,0x01,0x07,0x0f,0x18,0x10,0x10,0x10,0x18,0x0c,0x06,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x20,0x20,0xf0,0xf0,0x00,0x00,0xc0,0xf0,0xf8,0x0c,0x04,0x04,0x04,0x0c,0xff,0xff,0x00,0x00,0x01,0x07,0x0f,0x18,0x10,0x10,0x18,0x0c,0x1f,0x0f,0x08,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xc0,0xf0,0xf8,0x4c,0x44,0x44,0x44,0x4c,0x78,0x70,0x00,0x00,0x01,0x07,0x0f,0x18,0x10,0x10,0x10,0x18,0x0c,0x04,0x00,
0x00,0x00,0x00,0x00,0x80,0xc0,0x60,0x20,0x20,0x20,0xe0,0xc0,0x00,0x04,0x04,0x04,0xff,0xff,0x04,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,0x10,0x10,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x70,0xf8,0x8c,0x04,0x04,0x8c,0xfc,0xfc,0x0c,0x0c,0x00,0x20,0x76,0xcf,0x8d,0x8d,0x8d,0x89,0xc9,0xf8,0x78,0x00,
0x00,0x20,0xe0,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x18,0x0c,0x04,0x04,0x1c,0xfc,0xf0,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,
0x00,0x00,0x00,0x00,0x00,0x60,0x60,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,0xfc,0xfc,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x1f,0x1f,0x10,0x10,0x10,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x60,0x60,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,0xfc,0xfc,0x00,0x00,0x00,0x00,0xc0,0xc0,0x80,0x80,0x80,0xc0,0x7f,0x3f,0x00,0x00,
0x00,0x20,0xe0,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x80,0xc0,0xf0,0x9c,0x0c,0x04,0x04,0x00,0x00,0x10,0x1f,0x1f,0x11,0x10,0x01,0x17,0x1f,0x1c,0x18,0x10,
0x00,0x00,0x20,0x20,0x20,0xe0,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x10,0x10,0x1f,0x1f,0x10,0x10,0x10,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xfc,0xfc,0x0c,0x04,0xfc,0xfc,0xfc,0x04,0x04,0xfc,0xf8,0x10,0x1f,0x1f,0x10,0x10,0x1f,0x1f,0x1f,0x10,0x10,0x1f,0x1f,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xfc,0xfc,0x18,0x0c,0x04,0x04,0x1c,0xfc,0xf0,0x00,0x00,0x10,0x1f,0x1f,0x10,0x00,0x00,0x10,0x10,0x1f,0x1f,0x10,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xe0,0xf0,0x38,0x0c,0x04,0x04,0x04,0x0c,0xf8,0xf0,0xc0,0x00,0x03,0x0f,0x0e,0x18,0x10,0x10,0x10,0x18,0x0f,0x07,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xfc,0xfc,0x18,0x0c,0x04,0x04,0x0c,0xf8,0xf8,0xc0,0x00,0x80,0xff,0xff,0x98,0x90,0x10,0x10,0x18,0x0f,0x07,0x01,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xe0,0xf0,0xf8,0x0c,0x04,0x04,0x0c,0xf8,0xfc,0xfc,0x00,0x00,0x03,0x0f,0x1f,0x18,0x10,0x10,0x98,0xff,0xff,0xff,0x80,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0xfc,0xfc,0xfc,0x18,0x0c,0x04,0x0c,0x0c,0x08,0x00,0x10,0x10,0x1f,0x1f,0x1f,0x10,0x10,0x10,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x30,0x78,0x4c,0xc4,0x84,0x84,0x8c,0x1c,0x18,0x00,0x00,0x00,0x1e,0x1c,0x18,0x10,0x10,0x11,0x19,0x1f,0x0e,0x00,
0x00,0x00,0x00,0x00,0x00,0xc0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0x04,0xff,0xff,0x04,0x04,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x07,0x1f,0x18,0x10,0x10,0x18,0x0c,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0xfc,0xfe,0x00,0x00,0x00,0x04,0xfc,0xfe,0xfe,0x00,0x00,0x00,0x0f,0x1f,0x18,0x10,0x10,0x18,0x1f,0x1f,0x0f,0x08,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x0c,0x7c,0xfc,0x84,0x00,0x80,0xf4,0x3c,0x0c,0x04,0x00,0x00,0x00,0x00,0x03,0x1f,0x1e,0x0f,0x01,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x1c,0xfc,0xf4,0x04,0xec,0xfc,0xfc,0x00,0xe4,0x7c,0x0c,0x00,0x00,0x01,0x1f,0x1e,0x07,0x00,0x1f,0x1f,0x07,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x0c,0x1c,0x3c,0xe4,0xc0,0xf4,0x1c,0x0c,0x04,0x00,0x00,0x10,0x10,0x1c,0x16,0x03,0x01,0x17,0x1e,0x1c,0x10,0x10,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x0c,0x3c,0xfc,0xc4,0x00,0x84,0xf4,0x3c,0x04,0x04,0x00,0x00,0xc0,0xc0,0x81,0x7f,0x3e,0x07,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x1c,0x0c,0x04,0xc4,0xe4,0x74,0x3c,0x0c,0x04,0x00,0x00,0x00,0x18,0x1e,0x17,0x13,0x10,0x10,0x18,0x1c,0x1e,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xf8,0xfc,0x04,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x38,0xef,0xc7,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3f,0x7f,0x40,0x40,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xff,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x04,0x0c,0xfc,0xf0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xef,0xff,0x10,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x60,0x7f,0x1f,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x18,0x0e,0x02,0x06,0x0e,0x1c,0x38,0x30,0x20,0x30,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};
unsigned long get_file_size(const char *path)  
{  

    unsigned long filesize = -1;  
    FILE *fp;  
    fp = fopen(path, "r");  
    if(fp == NULL)  
        return filesize;  
    fseek(fp, 0L, SEEK_END);  
    filesize = ftell(fp);  
    fclose(fp);  
    return filesize;  
}  


void InitFontLib(void)
{
    BYTE abyTemp[21];
    int fp;
    DWORD dwOutLen;
    g_iChineseFontFlag = 0;
    g_iHaveFontFlag = 0;
	g_iUnicodeFontFlag = 0;


	
	if(FONTLIB_ADDR==NULL) 
		FONTLIB_ADDR = (unsigned char *)malloc(4200*1024);//910*1024


    g_iFontFileLen = get_file_size(DEFAULT_FONT);
    if (g_iFontFileLen < 2000)
    { 

		g_iFontFileLen = get_file_size(DEFAULT_FONT2);
		if (g_iFontFileLen < 2000)
		{
			g_iFontFileLen = get_file_size(DEFAULT_FONT3);
			if (g_iFontFileLen < 2000)
			{
				printf("can't open font file.");
				return;
			}
		}
    }
    // 读取字库内容到SDRAM中
    fp = open(DEFAULT_FONT, O_RDONLY);
    if(fp<0)
	{
		fp = open(DEFAULT_FONT2, O_RDONLY);
	    if(fp<0)
		{
			fp = open(DEFAULT_FONT3, O_RDONLY);
		}
	}
    if (fp >= 0)
    {
        (void)read(fp, (BYTE*)FONTLIB_ADDR, 20);
       
        (void)read(fp, (BYTE*)FONTLIB_ADDR+20, g_iFontFileLen-20);//+20  0xf0000
		
		if (g_iFontFileLen==2725144)//GB18030
		{
			g_gb2312_gbk_flag = 0;
		}
		else if (g_iFontFileLen==931568)//GB2312
		{
			g_gb2312_gbk_flag = 1;
		}
        (void)close(fp);
		
        memcpy(&g_sVFontLibHead, (BYTE*)FONTLIB_ADDR, sizeof(VFONT_LIB_STRUCT));
        g_strFontLib = (char*)FONTLIB_ADDR;
        g_iHaveFontFlag = 1;  // 设置字库是否存在的标志
        
        if (1 == g_sVFontLibHead.byLangeType)
        {
            g_iChineseFontFlag = 1;
        }
		else
		{
			g_iChineseFontFlag = 0;
		}
		if (memcmp((BYTE*)FONTLIB_ADDR,"UFL",3) == 0)
		{
            g_iChineseFontFlag = 1;
			g_iUnicodeFontFlag = 1;
			g_iUnicodePrinterFlag = 1;
			if (g_iFontFileLen == 336528)//NoCJK,336528
			{
				g_iUnicodeNoCJKFlag = 1;
				g_iUnicodeBefore2f00Flag = 0;
			}
			else if (g_iFontFileLen == 117272)//Before2F00,117272
			{
				g_iUnicodeBefore2f00Flag = 1;
				g_iUnicodeNoCJKFlag = 0;
			}
			else
			{
				g_iUnicodeNoCJKFlag=g_iUnicodeBefore2f00Flag=0;
			}
		}
		else
		{
			g_iUnicodeFontFlag = 0;
			g_iUnicodePrinterFlag = 0;
		}
    }
	else 
	{
		printf("can't open font file.");
		g_iHaveFontFlag = 0;
		g_iUnicodePrinterFlag = 0;
	}
	
}

int ReadFontHeader(BYTE byFontHeight)
{	
	int i;
	if (byFontHeight == 16)
	{
		 memcpy(&_fl_header, &g_strFontLib[0], 16);
	}
	else if (byFontHeight == 24)
	{
		if (g_iUnicodeNoCJKFlag)
		{
			memcpy(&_fl_header, &g_strFontLib[127152],16);//127152(sizeof U16 font in NoCJK)
		}
		else if (g_iUnicodeBefore2f00Flag)
		{
			memcpy(&_fl_header, &g_strFontLib[51192],16);//51192(sizeof U16 font in Before2F00)
		}
		else
		{
			memcpy(&_fl_header, &g_strFontLib[1420408],16);//1,420,408(sizeof U16 font in whole unicode)
		}
	}
	else return -1;
	//锟斤拷锟斤拷示头
	if((_fl_header.magic[0] != 'U') || (_fl_header.magic[1] != 'F') || (_fl_header.magic[2] != 'L'))
	{
		return -2;
	}

	_pfl_header = (PFL_Header)&_fl_header;
//	logs();

	if (byFontHeight==16)
	{
		_pfl_header->pSection = (FL_SECTION_INF  *)(&g_strFontLib[16]);
	}
	else if (byFontHeight==24)
	{
		if (g_iUnicodeNoCJKFlag)
		{
			_pfl_header->pSection=(FL_SECTION_INF  *)(&g_strFontLib[127152+16]);
		}
		else if (g_iUnicodeBefore2f00Flag)
		{
			_pfl_header->pSection=(FL_SECTION_INF  *)(&g_strFontLib[51192+16]);
		}
		else
		{
			_pfl_header->pSection=(FL_SECTION_INF  *)(&g_strFontLib[1420408+16]);
		}
	}
	else return -3;
	return 0;	
}

//s_GetGB2312DotMatrix
int s_GetUnicodeDotMatrix(const BYTE *str, BYTE byFontHeight, BYTE *pbyCharDotMatrix)
{
	int iUnicodeAddr;
	uchar i;

	uchar cUnicode[2];
	DWORD StartAddr;
	uchar cTemp[4];
	uchar cWidth;
	DWORD DotMatrixBytes;//锟斤拷锟斤拷锟斤拷莩锟斤拷锟�

	cUnicode[0]=str[1];
	cUnicode[1]=str[0];
	ReadFontHeader(byFontHeight);


	for (i=0;i<_fl_header.nSection;i++)
	{
		
	//	LOG("*(ushort *)&cUnicode[0] = %d", (*(ushort *)&cUnicode[0]));
	//	LOG("_pfl_header->pSection[i].First = %d", _pfl_header->pSection[i].First);
	//	LOG("_pfl_header->pSection[i].Last = %d", _pfl_header->pSection[i].Last);
		if((*(ushort *)&cUnicode[0] >= _pfl_header->pSection[i].First) && (*(ushort *)&cUnicode[0] <= _pfl_header->pSection[i].Last))
			break;
	}

	if(i >= _fl_header.nSection)	
	{
		return -1;
	}
	StartAddr = (*(ushort *)&cUnicode[0] - _pfl_header->pSection[i].First) * sizeof(UFL_CHAR_INDEX) + _pfl_header->pSection[i].OffAddr;
//	LOGI("byFontHeight = %d, StartAddr = %d", byFontHeight, StartAddr);//byFontHeight = 16, StartAddr = 604272936	
	if (byFontHeight==16)
	{
		cTemp[0] = g_strFontLib[StartAddr];
		cTemp[1] = g_strFontLib[StartAddr+1];
		cTemp[2] = g_strFontLib[StartAddr+2];
		cTemp[3] = g_strFontLib[StartAddr+3];
	//	LOG("cTemp = %02x %02x %02x %02x ",	cTemp[0],cTemp[1],cTemp[2],cTemp[3]);
	}
	else if (byFontHeight==24)
	{
		if (g_iUnicodeNoCJKFlag)
		{
			cTemp[0] = g_strFontLib[127152+StartAddr];
			cTemp[1] = g_strFontLib[127152+StartAddr+1];
			cTemp[2] = g_strFontLib[127152+StartAddr+2];
			cTemp[3] = g_strFontLib[127152+StartAddr+3];
		//	logs();	
		}
		else if (g_iUnicodeBefore2f00Flag)
		{
			cTemp[0] = g_strFontLib[51192+StartAddr];
			cTemp[1] = g_strFontLib[51192+StartAddr+1];
			cTemp[2] = g_strFontLib[51192+StartAddr+2];
			cTemp[3] = g_strFontLib[51192+StartAddr+3];
		}
		else
		{
			cTemp[0] = g_strFontLib[1420408+StartAddr];
			cTemp[1] = g_strFontLib[1420408+StartAddr+1];
			cTemp[2] = g_strFontLib[1420408+StartAddr+2];
			cTemp[3] = g_strFontLib[1420408+StartAddr+3];	
		}
	}
	else {return -2;}
	
	cWidth = (cTemp[3] & 0xfc);
	cWidth = cWidth >> 2;

	g_uWidth = cWidth;
	g_uHeigh = _pfl_header->YSize;
	
	DotMatrixBytes = ((cWidth + 7) / 8) * _pfl_header->YSize;//锟斤拷取锟斤拷锟斤拷锟街斤拷锟斤拷
//	LOGI("cWidth = %d, DotMatrixBytes = %d, cTemp[3] = %02x", cWidth, DotMatrixBytes, cTemp[3]);
	cTemp[3] = cTemp[3] & 0x03;
	if (byFontHeight==16)
	{
	//	LOGI("*(unsigned int *)&cTemp[0] = %d", *(unsigned int *)&cTemp[0]);
		memcpy(pbyCharDotMatrix, &g_strFontLib[*(unsigned int *)&cTemp[0]], DotMatrixBytes);
	}
	else if (byFontHeight==24)
	{
		if (g_iUnicodeNoCJKFlag)
		{
			memcpy(pbyCharDotMatrix, &g_strFontLib[127152 + *(unsigned int *)&cTemp[0]], DotMatrixBytes);
		}
		else if (g_iUnicodeBefore2f00Flag)
		{
			memcpy(pbyCharDotMatrix, &g_strFontLib[51192 + *(unsigned int *)&cTemp[0]], DotMatrixBytes);
		}
		else
		{
			memcpy(pbyCharDotMatrix, &g_strFontLib[1420408 + *(unsigned int *)&cTemp[0]], DotMatrixBytes);
		}
	}
	else return -3;

	return 0;
}


/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int GetAsciiDotMatrix(BYTE *str, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix)
  锟斤拷锟斤拷       :  锟斤拷取ASCII锟斤拷锟斤拷锟斤拷息
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷char *str锟斤拷锟街凤拷
                2锟斤拷BYTE byFontHeight锟斤拷锟街凤拷母叨锟�
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *pbyCharDotMatrix锟斤拷锟街凤拷牡锟斤拷锟斤拷锟较�
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-14   V1.0        锟斤拷锟斤拷
****************************************************************************/
int s_GetAsciiDotMatrix(const BYTE *str, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix)
{
    int iStep;
    int iCharIndex,
        iDotOffset,
        iDotLeght;
//logs();
    if ( (str[0]<0x20) || (str[0]>=0x80))
    {
        return 1;
    }
    iCharIndex = str[0] - 0x20;
    iStep = g_sVFontLibHead.tUnion.sCFontEncode[0].abyStepLength[0]*256
        + g_sVFontLibHead.tUnion.sCFontEncode[0].abyStepLength[1];
	//printf("byFontHeight0 = 0x%d \r\n",byFontHeight);
    switch (byFontHeight)
    {
    case 8:
    case 12:
        iDotOffset = 0;
        iDotLeght = 6;
	//	font_len = iDotLeght;
        break;
    case 16:
        iDotOffset = 6;
        iDotLeght = 16;
	//	font_len = iDotLeght;
        break;
    case 24:
        iDotOffset = 22;
        iDotLeght = 36;
	//	font_len = iDotLeght;
        break;
    default:
        return 1;
    }
    memcpy(pbyCharDotMatrix,
        &g_strFontLib[512+iCharIndex*iStep+iDotOffset],
        iDotLeght);

	//printf("font_len2 = 0x%d \r\n",font_len);

    return 0;
}

/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int GetGB2312DotMatrix(char *str, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix)
  锟斤拷锟斤拷       :  锟斤拷取GB2312锟街凤拷牡锟斤拷锟斤拷锟较�
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷char *str锟斤拷要锟斤拷取锟斤拷锟斤拷锟斤拷址锟斤拷锟斤拷锟斤拷纸锟�
                2锟斤拷BYTE byFontHeight锟斤拷锟街凤拷母叨龋锟饺≈滴�12锟斤拷16锟斤拷24锟斤拷锟斤拷锟斤拷值锟角凤拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *pbyCharDotMatrix锟斤拷锟街凤拷牡锟斤拷锟斤拷锟较�
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷2锟斤拷没锟叫该碉拷锟斤拷锟斤拷息
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-14   V1.0        锟斤拷锟斤拷
****************************************************************************/
int s_GetGB2312DotMatrix(const BYTE *str, BYTE byFontHeight, BYTE *pbyCharDotMatrix)
{
    int i;
    int iStep = 122,      // 锟街凤拷锟斤拷锟斤拷锟侥诧拷锟斤拷
        iGB2312DotAddr=0, // GB2312锟街凤拷牡锟斤拷锟斤拷锟斤拷锟斤拷始锟斤拷址
        iGB2312Addr = 0;  // GB2312锟街凤拷锟斤拷锟斤拷锟绞硷拷锟街�
    int iCharIndex,       // 锟街凤拷锟斤拷锟斤拷锟�
        iDotIndex;        // 锟街凤拷锟斤拷锟斤拷诘锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷
    int iDotOffset = 0,
        iDotLeght = 0;

	//LOGD("s_GetGB2312DotMatrix = %02x %02x", str[0], str[1]);
    if ((str[0]<=0x80) || (str[1]<0x40))
    {
        return 1;
    }
	//LOGD("byFontHeight = 0x%d \r\n",byFontHeight);
    switch (byFontHeight)
    {
    case 8:
        memset(pbyCharDotMatrix, 0xff, 12);
        return 0;
    case 12:
        iDotOffset = 0;
        iDotLeght = 18;
	//			font_len = iDotLeght;
        break;
    case 16:
        iDotOffset = 18;
        iDotLeght = 32;
	//			font_len = iDotLeght;
        break;
    case 24:
        iDotOffset = 50;
        iDotLeght = 72;
	//			font_len = iDotLeght;
        break;
    default:
        return 1;
    }
	//printf("font_len3 = 0x%d \r\n",font_len);

    iGB2312Addr = g_sVFontLibHead.tUnion.sCFontEncode[1].abyOffsetAddr[1]*65536
        + g_sVFontLibHead.tUnion.sCFontEncode[1].abyOffsetAddr[2]*256
        + g_sVFontLibHead.tUnion.sCFontEncode[1].abyOffsetAddr[3];
    iGB2312DotAddr = iGB2312Addr + GB2312_INDEX_LENGTH*2;

    // 锟街凤拷锟斤拷锟斤拷锟侥诧拷锟斤拷
    iStep = g_sVFontLibHead.tUnion.sCFontEncode[1].abyStepLength[0]*256
        + g_sVFontLibHead.tUnion.sCFontEncode[1].abyStepLength[1];

    if (   (str[0]>=0xa1) && (str[0]<=0xf7)
        && (str[1]>=0xa1) && (str[1]<=0xfe)  )  // GB2312锟斤拷锟斤拷
    {
        iCharIndex = (str[0]-0xa1)*94 + (str[1]-0xa1);  // 锟斤拷取锟街凤拷锟斤拷锟斤拷值
        iDotIndex = g_strFontLib[iGB2312Addr+iCharIndex*2]*256
            + g_strFontLib[iGB2312Addr+iCharIndex*2+1];   // 锟斤拷取锟街凤拷锟节碉拷锟斤拷锟斤拷锟斤拷锟斤拷锟�

        if (iDotIndex >= 7445)
        {
            return 2;
        }
        memcpy(pbyCharDotMatrix,
            &g_strFontLib[iGB2312DotAddr+iDotIndex*iStep+iDotOffset], iDotLeght);

        return 0;
    }
    else if ((str[0]>0xf7) && (str[1]>0xa0))
    {
        return 2;
    }
    else  // 锟斤拷展锟斤拷锟紾B2312锟斤拷GBK锟斤拷锟斤拷
    {
        // 锟斤拷锟斤拷展锟斤拷锟斤拷锟斤拷锟街凤拷锟斤拷锟斤拷锟较�

        return 2;
    }
}

int s_GetBackupDotMatrix(const BYTE *str, BYTE byFontHeight, BYTE *pbyCharDotMatrix)
{
	int i;
    switch (byFontHeight)
    {
    case 8:
        if ((str[0]<0x20) || (str[0]>=0x80))
        {
            memset(pbyCharDotMatrix, 0, 6);
        }
        else
        {
            memcpy(pbyCharDotMatrix, &Ch8ModAddr[(str[0]-0x20)*6], 6);
        }
	//	font_len = 6;

        return 0;
    case 16:
        if ((str[0]<0x20) || (str[0]>=0x80))
        {
            memset(pbyCharDotMatrix, 0, 16);
        }
        else
        {
            memcpy(pbyCharDotMatrix, &Ch16ModAddr[(str[0]-0x20)*16], 16);
		//	logs();
        }
	//	font_len = 16;
        return 0;
	case 24:
//		s_UartPrint(COM_DEBUG,"str is %02x\r\n",str[0]);
        if ((str[0]<0x20) || (str[0]>=0x80))
        {
            memset(pbyCharDotMatrix, 0, 36);
        }
        else
        {
            memcpy(pbyCharDotMatrix, &Fnt_asc12x24[(str[0]-0x20)*36], 36);
        }
        return 0;
    default:
        return 1;
    }
//	printf("font_len1 = 0x%d \r\n",font_len);
}

/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int GetFontDotMatrix(const BYTE *strIn, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix, BYTE *pbyOutCharLen)
  锟斤拷锟斤拷       :  锟斤拷取锟街凤拷锟斤拷锟斤拷锟较�
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷const BYTE *strIn:要锟斤拷取锟斤拷锟斤拷锟斤拷址锟斤拷锟斤拷
                2锟斤拷BYTE byFontHeight:锟斤拷锟斤拷母叨龋锟�
                             锟斤拷锟街凤拷为ASCII锟街凤拷锟绞憋拷锟街伙拷锟饺≈�8锟斤拷锟斤拷16
                             锟斤拷锟街凤拷为GB2312锟街凤拷锟绞憋拷锟街伙拷锟饺≈�16
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *pbyCharDotMatrix:锟街凤拷牡锟斤拷锟斤拷锟捷ｏ拷锟斤拷锟饺硷拷说锟斤拷
                2锟斤拷BYTE *pbyOutCharLen:锟街凤拷龋锟饺≈滴�0锟斤拷1锟斤拷锟斤拷2锟斤拷
                     0:锟斤拷示锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷
                     1:锟斤拷示锟斤拷锟斤拷锟絪trIn锟斤拷ASCII锟街凤拷
                     2:锟斤拷示锟斤拷锟斤拷锟絪trIn锟斤拷GB2312锟街凤拷
  锟斤拷锟斤拷值     :  1:锟斤拷锟斤拷锟斤拷锟絪trIn锟斤拷锟斤拷;
                2:锟斤拷锟斤拷锟斤拷锟絙yFontHeight锟斤拷锟斤拷;
                3:锟斤拷锟斤拷锟斤拷锟絧byCharDotMatrix锟斤拷锟斤拷;
                4:没锟叫该碉拷锟斤拷锟斤拷息;
                5:没锟斤拷锟街匡拷锟侥硷拷.
                6:GB2312锟街凤拷支锟街高讹拷为8锟侥碉拷锟斤拷
  说锟斤拷 : 1锟斤拷锟竭讹拷为8锟斤拷ASCII锟街凤拷pbyCharDotMatrix锟斤拷锟轿�6锟街节ｏ拷锟斤拷示6*8锟斤拷锟斤拷
            每锟斤拷锟街节憋拷示一锟斤拷锟斤拷锟脚的碉拷锟襟，碉拷锟斤拷锟斤拷欧锟剿筹拷锟斤拷锟斤拷拢锟�
            ......
            ......
            ......
            ......
            ......---> 0 1 2 3 4 5
            ......
            ......
            ......
         2锟斤拷锟竭讹拷为16锟斤拷ASCII锟街凤拷pbyCharDotMatrix锟斤拷锟轿�16锟街节ｏ拷锟斤拷示8*16锟斤拷锟斤拷
            每锟斤拷锟街节憋拷示一锟斤拷锟斤拷锟脚的碉拷锟襟，碉拷锟斤拷锟斤拷欧锟剿筹拷锟斤拷锟斤拷拢锟�
            ........
            ........
            ........
            ........
            ........---> 0 1 2 3 4 5 6 7
            ........
            ........
            ........

            ........
            ........
            ........
            ........
            ........---> 8 9 10 11 12 13 14 15
            ........
            ........
            ........
         3锟斤拷锟竭讹拷为16锟斤拷ASCII锟街凤拷pbyCharDotMatrix锟斤拷锟轿�32锟街节ｏ拷锟斤拷示16*16锟斤拷锟斤拷
            每锟斤拷锟街节憋拷示一锟斤拷锟斤拷锟脚的碉拷锟襟，碉拷锟斤拷锟斤拷欧锟剿筹拷锟斤拷锟斤拷拢锟�
            ................
            ................
            ................
            ................
            ................---> 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15
            ................
            ................
            ................

            ................
            ................
            ................
            ................
            ................---> 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31
            ................
            ................
            ................
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2008-02-21   V1.0        锟斤拷锟斤拷
****************************************************************************/
int Lib_GetFontDotMatrix(const BYTE *strIn, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix, BYTE *pbyOutCharLen)
{
    int iRet;

    *pbyOutCharLen = 0;
    if ( (strIn[0]<0x20) || (strIn[0]==0x80))
    {
        return 1;  //
    }

    if ((strIn[0]>0x80) && (strIn[1]<0x40))
    {
        return 1;
    }

    if ((8!=byFontHeight) && (16!=byFontHeight))
    {
        return 2;
    }

    if (NULL == pbyCharDotMatrix)
    {
        return 3;
    }
    if (strIn[0] < 0x80)
    {
        *pbyOutCharLen = 1;
        iRet = GetCharDotMatrix(strIn, ASCII_FONT, byFontHeight, pbyCharDotMatrix);
    }
    else
    {
        if (8 == byFontHeight)
        {
            return 6;
        }
        *pbyOutCharLen = 2;
        iRet = GetCharDotMatrix(strIn, GB2312_FONT, byFontHeight, pbyCharDotMatrix);
    }
    if (0 == iRet)
    {
        return 0;
    }
    return (iRet+2);

}



/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int GetCharDotMatrix(BYTE *str, BYTE byCharSet, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix)
  锟斤拷锟斤拷       :  锟斤拷取锟街匡拷锟斤拷址锟斤拷锟斤拷锟斤拷息
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷char *str锟斤拷锟街凤拷byCharSet=ASCII_FONT时锟斤拷str锟斤拷锟斤拷为1
                                    锟斤拷byCharSet=GB2312_FONT时锟斤拷str锟斤拷锟斤拷为2
                2锟斤拷BYTE byCharSet锟斤拷锟街凤拷锟斤拷耄珹SCII_FONT/GB2312_FONT
                3锟斤拷BYTE byFontHeight锟斤拷锟街凤拷母叨龋锟饺≈�8锟斤拷12锟斤拷16锟斤拷24锟斤拷
                   锟斤拷锟斤拷ASCII 锟斤拷取值 8锟斤拷16锟斤拷24锟斤拷
                       GB2312锟斤拷取值12锟斤拷16锟斤拷24锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *pbyCharDotMatrix锟斤拷锟街凤拷牡锟斤拷锟斤拷锟较�
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷2锟斤拷没锟叫该碉拷锟斤拷锟斤拷息锟斤拷3锟斤拷没锟斤拷锟街匡拷锟侥硷拷
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-14   V1.0        锟斤拷锟斤拷
****************************************************************************/
int GetCharDotMatrix(const BYTE *str, BYTE byCharSet, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix)
{
if (1 != g_iHaveFontFlag)
    {
        if (ASCII_FONT == byCharSet)
        {
            return s_GetBackupDotMatrix(str, byFontHeight, pbyCharDotMatrix);
        }
        return 3;
    }

	if(g_iUnicodeFontFlag==0)
	{
		if ( (1==g_sVFontLibHead.byLangeType) && (0==g_sVFontLibHead.byLangeCodeType) )
		{
			// 处理中文GB2312字库
			switch (byCharSet)
			{
			case ASCII_FONT:
//				s_UartPrint(COM_DEBUG,"ASCII_FONT\r\n");
				return s_GetAsciiDotMatrix(str, byFontHeight, pbyCharDotMatrix);
			case GB2312_FONT:
				return s_GetGB2312DotMatrix(str, byFontHeight, pbyCharDotMatrix);
			default:
				return 1;
			}
		}
	}
	else
	{  
		switch(byCharSet)
		{
		case ASCII_FONT:
//				s_UartPrint(COM_DEBUG,"ASCII_FONT\r\n");
			return s_GetBackupDotMatrix(str, byFontHeight, pbyCharDotMatrix);
		case GB2312_FONT:
//				s_UartPrint(COM_DEBUG,"GB2312_FONT\r\n");
			if (g_iPrinterUnicode)
			{
//				return s_GetUnicodeDotMatrix(str,byFontHeight,pbyCharDotMatrix);
				if (!g_iUnicodePrinterFlag)
				{
					//g_iUnicodeDisplayFlag = 0;
					g_uWidth = byFontHeight/2;
					return s_GetBackupDotMatrix(str, byFontHeight, pbyCharDotMatrix);
				}
				else
				{
					//g_iUnicodeDisplayFlag = 1;
//					s_UartPrint(COM_DEBUG,"get unicode dot data\r\n");
					return s_GetUnicodeDotMatrix(str,byFontHeight,pbyCharDotMatrix);
				}
			}
			else
			{
				if (str[0]==0x00 && ((str[1]>=0x00)&&(str[1]<=0xFF)))
				{
					g_uWidth = byFontHeight/2;
					return s_GetBackupDotMatrix(&str[1], byFontHeight, pbyCharDotMatrix);
				}
				else
				{
					return s_GetUnicodeDotMatrix(str,byFontHeight,pbyCharDotMatrix);
				}
			}
		default:
			return 1;
		}
	}
    return 1;
}

/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  void ConvertCharDotMatrix(BYTE byCharSet, BYTE byFontHeight,
                     BYTE *pbyInCharDotMatrix, BYTE *pbyOutResult)
  锟斤拷锟斤拷       :  锟斤拷锟斤拷示锟斤拷锟斤拷转锟斤拷锟缴达拷印锟斤拷锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE byCharSet锟斤拷锟街凤拷锟斤拷耄拷锟饺≈�0锟斤拷1
                2锟斤拷BYTE byFontHeight锟斤拷锟街凤拷叨龋锟斤拷锟饺≈�16锟斤拷锟斤拷24
                3锟斤拷BYTE *pbyInCharDotMatrix锟斤拷要转锟斤拷锟侥碉拷锟斤拷锟斤拷锟�
                4锟斤拷BYTE byZoom锟斤拷锟脚达拷锟斤拷锟�
                   bit0锟斤拷示X锟斤拷锟斤拷糯锟絙it0=0锟斤拷示X锟斤拷锟津不放达拷bit0=1锟斤拷示X锟斤拷锟斤拷糯锟�2锟斤拷
                   bit1锟斤拷示Y锟斤拷锟斤拷糯锟絙it1=0锟斤拷示Y锟斤拷锟津不放达拷bit1=1锟斤拷示Y锟斤拷锟斤拷糯锟�2锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *pbyOutResult锟斤拷转锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟�
  锟斤拷锟斤拷值     :  锟斤拷
  注   锟斤拷    :  锟斤拷锟斤拷锟斤拷锟絙yCharSet=0锟斤拷byFontHeight=24时锟斤拷锟斤拷锟斤拷牡锟斤拷锟斤拷锟捷筹拷锟斤拷为36锟斤拷
                锟斤拷锟斤拷慕锟斤拷锟斤拷锟斤拷锟捷筹拷锟斤拷为48
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-24   V1.0        锟斤拷锟斤拷
****************************************************************************/
void ConvertCharDotMatrix(BYTE byCharSet, BYTE byFontHeight,
                const BYTE *pbyInCharDotMatrix, BYTE *pbyOutResult, BYTE byZoom)
{
    int i, j;

    switch (byCharSet)
    {
    case ASCII_FONT:
        if (16 == byFontHeight)  // 8x16 in16 out16
        {
            byZoom &= 0x03;
            switch (byZoom)
            {
            case 0:  // 8X16
                memset(pbyOutResult, 0, 16);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<8; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[i+(j/8)*8]&(1<<(j%8))))
                        {
                            pbyOutResult[j] |= (1<<(7-i));
                        }
                    }
                }
                return ;
            case 1:  // 8X16----->16X16
                memset(pbyOutResult, 0, 32);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<8; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[i+(j/8)*8]&(1<<(j%8))))
                        {
                            pbyOutResult[j*2+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                }
                return ;
            case 2:  // 8X16----->8X32
                memset(pbyOutResult, 0, 32);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<8; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[i+(j/8)*8]&(1<<(j%8))))
                        {
                            pbyOutResult[j*2] |= (1<<(7-i));
                        }
                    }
                    pbyOutResult[j*2+1] = pbyOutResult[j*2];
                }
                return ;
            default:  // 8X16----->16X32
                memset(pbyOutResult, 0, 64);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<8; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[i+(j/8)*8]&(1<<(j%8))))
                        {
                            pbyOutResult[j*4+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                    memcpy(&pbyOutResult[j*4+2], &pbyOutResult[j*4], 2);
                }
                return ;
            }
        }
        else  // 12x24 in36 out48
        {
            byZoom &= 0x03;
            switch (byZoom)
            {
            case 0:  // 12X24
                memset(pbyOutResult, 0, 48);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<12; i++)  // 锟叫猴拷
                    {
                        if (pbyInCharDotMatrix[i+(j/8)*12]&(1<<((j%8))))
                        {
                            pbyOutResult[j*2+i/8] |= 1<<(7-i%8);
                        }
                    }
                }
                return ;
            case 1:  // 24X24
                memset(pbyOutResult, 0, 72);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<12; i++)  // 锟叫猴拷
                    {
                        if (pbyInCharDotMatrix[i+(j/8)*12]&(1<<((j%8))))
                        {
                            pbyOutResult[j*3+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                }
                return ;
            case 2:  // 12X48
                memset(pbyOutResult, 0, 96);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<12; i++)  // 锟叫猴拷
                    {
                        if (pbyInCharDotMatrix[i+(j/8)*12]&(1<<((j%8))))
                        {
                            pbyOutResult[j*4+i/8] |= 1<<(7-i%8);
                        }
                    }
                    memcpy(&pbyOutResult[j*4+2], &pbyOutResult[j*4], 2);
                }
                return ;
            default:  // 24X48
                memset(pbyOutResult, 0, 144);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<12; i++)  // 锟叫猴拷
                    {
                        if (pbyInCharDotMatrix[i+(j/8)*12]&(1<<((j%8))))
                        {
                            pbyOutResult[j*6+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                    memcpy(&pbyOutResult[j*6+3], &pbyOutResult[j*6], 3);
                }
                return ;
            }
        }

    default:  // GB2312_FONT
        if (16 == byFontHeight)  // 16x16 in32 out32
        {
            byZoom &= 0x03;
            switch (byZoom)
            {
            case 0:  // 16X16
                memset(pbyOutResult, 0, 32);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<16; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*16+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*2+i/8] |= 1<<(7-i%8);
                        }
                    }
                }
                return ;
            case 1:  // 16X16------>16X32
                memset(pbyOutResult, 0, 64);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<16; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*16+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*4+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                }
                return ;
            case 2:  // 16X16------>32X16
                memset(pbyOutResult, 0, 64);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<16; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*16+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*4+i/8] |= 1<<(7-i%8);
                        }
                    }
                    memcpy(&pbyOutResult[j*4+2], &pbyOutResult[j*4], 2);
                }
                return ;
            default:  // 16X16------>32X32
                memset(pbyOutResult, 0, 128);
                for (j=0; j<16; j++)  // 锟叫猴拷
                {
                    for (i=0; i<16; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*16+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*8+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                    memcpy(&pbyOutResult[j*8+4], &pbyOutResult[j*8], 4);
                }
                return ;
            }
        }
        else  // 24x24  72bytes in72 out72
        {
            byZoom &= 0x03;
            switch (byZoom)
            {
            case 0:  // 24X24
                memset(pbyOutResult, 0, 72);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<24; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*24+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*3+i/8] |= 1<<(7-i%8);
                        }
                    }
                }
                return ;
            case 1:  // 24X24---->24X48
                memset(pbyOutResult, 0, 144);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<24; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*24+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*6+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                }
                return ;
            case 2:  // 24X24---->48X24
                memset(pbyOutResult, 0, 144);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<24; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*24+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*6+i/8] |= 1<<(7-i%8);
                        }
                    }
                    memcpy(&pbyOutResult[j*6+3], &pbyOutResult[j*6], 3);
                }
                return ;
            default:  // 24X24---->48X48
                memset(pbyOutResult, 0, 288);
                for (j=0; j<24; j++)  // 锟叫猴拷
                {
                    for (i=0; i<24; i++)  // 锟叫猴拷
                    {
                        if (0 != (pbyInCharDotMatrix[(j/8)*24+i]&(1<<(j%8))))
                        {
                            pbyOutResult[j*12+i/4] |= (3<<((3-i%4)*2));
                        }
                    }
                    memcpy(&pbyOutResult[j*12+6], &pbyOutResult[j*12], 6);
                }
                return ;
            }
        }
    }
}


/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int GetPrnCharDotMatrix(BYTE *str, BYTE byCharSet, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix, BYTE byZoom)
  锟斤拷锟斤拷       :  锟斤拷取锟斤拷印锟街凤拷锟斤拷锟�
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *str锟斤拷锟街凤拷
                2锟斤拷BYTE byCharSet锟斤拷锟街凤拷锟斤拷耄�0锟斤拷示ASCII锟斤拷锟诫，1锟斤拷示GB2312锟斤拷锟斤拷
                3锟斤拷BYTE byFontHeight锟斤拷锟街凤拷叨龋锟斤拷锟饺≈�16锟斤拷锟斤拷24
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *pbyCharDotMatrix锟斤拷锟街凤拷锟斤拷锟斤拷锟斤拷
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷锟斤拷2锟斤拷没锟叫碉拷锟斤拷锟斤拷息锟斤拷3锟斤拷没锟斤拷锟街匡拷
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-24   V1.0        锟斤拷锟斤拷
****************************************************************************/
int GetPrnCharDotMatrix(const BYTE *str, BYTE byCharSet, BYTE byFontHeight,
                     BYTE *pbyCharDotMatrix, BYTE byZoom)
{
	static BYTE abyTemp[300];//73
	int iRet = 0;
	int k;

	if ((16!=byFontHeight) && (24!=byFontHeight))
	{
		return 1;
	}

	if(g_iUnicodeFontFlag == 0)
	{

		memset(abyTemp, 0, sizeof(abyTemp));
		iRet = GetCharDotMatrix(str, byCharSet, byFontHeight, abyTemp);
		
		if (0 == iRet)
		{
			ConvertCharDotMatrix(byCharSet, byFontHeight, abyTemp, pbyCharDotMatrix, byZoom&0x03);
			return 0;
		}
		else
		{
			return iRet;
		}
	}
	else
	{
		memset(abyTemp, 0, sizeof(abyTemp));
		g_iPrinterUnicode = 1;
		if (!g_iUnicodePrinterFlag)
		{
			iRet = GetCharDotMatrix(str, byCharSet, byFontHeight, abyTemp);


			if (0 == iRet)
			{
				ConvertCharDotMatrix(byCharSet, byFontHeight, abyTemp, pbyCharDotMatrix, byZoom&0x03);
				g_iPrinterUnicode = 0;
				return 0;
			}
			else
			{
				g_iPrinterUnicode = 0;
				return iRet;
			}
		}
		else
		{
			iRet = GetCharDotMatrix(str, byCharSet, byFontHeight, pbyCharDotMatrix);//abyTemp
			g_iPrinterUnicode = 0;
			return iRet;
		}
	}
}


/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int Lib_FontFileCheck(void)
  锟斤拷锟斤拷       :  锟斤拷锟斤拷挚锟斤拷欠锟斤拷锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  锟斤拷
  锟斤拷锟斤拷值     :  1锟斤拷没锟斤拷锟街库，0锟斤拷锟斤拷锟街匡拷
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-20   V1.0        锟斤拷锟斤拷
****************************************************************************/
int Lib_FontFileCheck(void)
{
    if (0 == g_iHaveFontFlag)
    {
        return FONT_NOEXISTERR;  // 没锟斤拷锟街匡拷
    }
    else
    {
        return 0;  // 锟斤拷锟斤拷锟街匡拷
    }
}

// 1:is chinese, 0:no chinese
int Font_IsChinese(void)
{
    return g_iChineseFontFlag;
}
/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int Lib_FontGetCharSet(BYTE *bCharSet, BYTE *bNum)
  锟斤拷锟斤拷       :  锟斤拷取锟街匡拷锟斤拷锟斤拷支锟街碉拷锟斤拷锟叫憋拷锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *bCharSet锟斤拷锟斤拷锟诫集
                2锟斤拷BYTE *bNum锟斤拷锟斤拷锟斤拷母锟斤拷锟�
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷没锟斤拷锟街库，2锟斤拷未知锟斤拷锟街匡拷
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-20   V1.0        锟斤拷锟斤拷
****************************************************************************/
int Lib_FontGetCharSet(BYTE *bCharSet, BYTE *bNum)
{
    if (0 == g_iHaveFontFlag)
    {
        return FONT_NOEXISTERR;
    }
	if (bCharSet == NULL || bNum == NULL)
	{
		return 1;
	}
    if ((0==g_sVFontLibHead.byLangeCodeType) && (1==g_sVFontLibHead.byLangeType))
    {
        bCharSet[0] = ASCII_FONT;
        bCharSet[1] = GB2312_FONT;
        *bNum = 2;
        return 0;
    }
    else
    {
        return FONT_NOSUPPORTERR;
    }
}

/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int Lib_FontGetHeight(BYTE bCharSet, BYTE *bHeight, BYTE * bHeightNum)
  锟斤拷锟斤拷       :  锟斤拷取锟街匡拷支锟街的高讹拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE bCharSet锟斤拷锟街凤拷锟斤拷锟�
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷BYTE *bHeight锟斤拷锟竭讹拷锟斤拷锟斤拷
                2锟斤拷BYTE * bHeightNum锟斤拷锟竭度革拷锟斤拷
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷没锟斤拷锟街库，2锟斤拷未知锟街库，3锟街匡拷锟斤拷锟�
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-20   V1.0        锟斤拷锟斤拷
****************************************************************************/
int Lib_FontGetHeight(BYTE bCharSet, BYTE *bHeight, BYTE * bHeightNum)
{
    int i;

    if (0 == g_iHaveFontFlag)
    {
        return FONT_NOEXISTERR;
    }
	if (bCharSet < 0 || bCharSet > 6)
	{
		return -1;
	}//add by tangdy
    if ((0==g_sVFontLibHead.byLangeCodeType) && (1==g_sVFontLibHead.byLangeType))
    {
        for (i=0; i<6; i++)
        {
            if (  (1==g_sVFontLibHead.tUnion.sCFontEncode[i].byValidFlag)
                &&(bCharSet==g_sVFontLibHead.tUnion.sCFontEncode[i].byCharSet))
            {
                *bHeightNum = g_sVFontLibHead.tUnion.sCFontEncode[i].byHeightNumber;
                memcpy(bHeight, g_sVFontLibHead.tUnion.sCFontEncode[i].abyHeight,
                    *bHeightNum);
                return 0;
            }
        }
        return FONT_NOSUPPORTERR;
    }
    else
    {
        return FONT_NOSUPPORTERR;
    }
}

/****************************************************************************
  锟斤拷锟斤拷锟斤拷     :  int Lib_FontGetStyle(VFONT_LIB_STRUCT *style_info)
  锟斤拷锟斤拷       :  锟斤拷取锟街匡拷锟斤拷锟斤拷锟斤拷锟较�
  锟斤拷锟斤拷锟斤拷锟�   :  锟斤拷
  锟斤拷锟斤拷锟斤拷锟�   :  1锟斤拷VFONT_LIB_STRUCT *style_info锟斤拷锟街匡拷锟斤拷息锟结构
  锟斤拷锟斤拷值     :  0锟斤拷锟缴癸拷锟斤拷1锟斤拷没锟斤拷锟街匡拷
  锟睫革拷锟斤拷史   :
      锟睫革拷锟斤拷     锟睫革拷时锟斤拷    锟睫改版本锟斤拷   锟睫革拷原锟斤拷
  1锟斤拷 锟狡匡拷锟斤拷     2007-09-20   V1.0        锟斤拷锟斤拷
****************************************************************************/
int Lib_FontGetStyle(VFONT_LIB_STRUCT *style_info)
{
	VFONT_LIB_STRUCT *temp = style_info;
	if (temp == NULL)
	{
		return FONT_NOSUPPORTERR;
	}
	
    if (0 == g_iHaveFontFlag)
    {
        return FONT_NOEXISTERR;
    }
    memcpy(style_info, &g_sVFontLibHead, sizeof(VFONT_LIB_STRUCT));
    return 0;
}

void free_font(void)
{
	free(FONTLIB_ADDR);
}

unsigned short getun(unsigned short int gb)
{
	int i;
	for(i=0;i<giGBCount;i++)
	{
		if (giGB2312[i][0]==gb)
		{
			return (giGB2312[i][1]);
		}
	}
	return 0xFFFF;
}

unsigned short getgb(unsigned short int unicode)
{
	int i;
	for(i=0;i<giGBCount;i++)
	{
		if (giGB2312[i][1]==ntohs(unicode))
			return giGB2312[i][0];
	}
	return 0xFFFF;
}

void BytesToWord(BYTE *pbyIn, int iLen, WORD *pdwOut)
{
    int i;
    for (i=0; i<iLen; i+=2)
    {
        pdwOut[i/2] = pbyIn[i]*256+pbyIn[i+1];
    }
}

void WordToBytes(WORD *pdwIn, int iLen, BYTE *pbyOut)
{
    int i;

    for (i=0; i<iLen; i++)
    {
        pbyOut[i*2  ] = (BYTE)(pdwIn[i]>>8);
        pbyOut[i*2+1] = (BYTE)(pdwIn[i]);
    }
}


int gb2unicode(unsigned short *unicode, char*gbSrc,int len)
{
	int i,j,k;
	unsigned short iTmp[2];
	unsigned char buf[2];


	
	i=0;
	for(j=0;i<len;j++)
	{
		if ((unsigned char)gbSrc[i]<=0x80)
		{
			buf[0] = 0x00;
			buf[1] = gbSrc[i];
			BytesToWord(buf,2,&unicode[j]);
			//unicode[j]=gb[i];
			//unicode[j]=htons(unicode[j]);
			i++;
		}
		else
		{
			buf[1] = gbSrc[i];
			buf[0] = gbSrc[i+1];
			BytesToWord(buf,2,iTmp);
		//	LOGI("buf 0 : %02x, buf 1 : %02x, iTmp : %04x", buf[0], buf[1], iTmp[0]);
		//	unicode[j]=getun(iTmp[0]);//*(unsigned short int*)(gb+i)
			unicode[j] = zz_gbk2uni(buf[1], buf[0]);
		//	LOGI("unicode[j] : %04x", unicode[j]);
			i+=2;
		}
	}
	return j*2;
}


